import{VctrApi}from"https://www.vectary.com/viewer-api/v1/api.js";import controlColorPicker from"../js/colorpicker.js";let viewerApi,selectedObject,ObjectList=[];async function run(){function e(e){console.log("API error",e)}viewerApi=new VctrApi("d6c1f27d-6a27-4c7e-bd7d-bd19d7faa56c",e);try{await viewerApi.init(),async function(){console.log("API ready");try{document.body.addEventListener("click",async e=>{e.target.id&&"d6c1f27d-6a27-4c7e-bd7d-bd19d7faa56c"==e.target.id&&(selectedObject=await viewerApi.getHitObjects(),showControlpanel(),handleObjectClick(selectedObject))});const t=await viewerApi.getMeshes();console.log("Meshed",t),buildObjectList((await viewerApi.getObjects()).filter(e=>"mesh"==e.type))}catch(t){e(t)}}()}catch(t){e(t)}}async function handleObjectClick(e){try{console.log("Objects:",e[0]);const t=document.querySelector("#control-head-title");let c=formatName(e[0].name);t.textContent=c,await setControlValues()}catch(e){}}async function updateObject(e){try{const{material:t}=selectedObject[0];await viewerApi.updateMaterial(t,e)}catch(e){}}function formatName(e){return e.replace(/_/g," ").toString().trim()}function handleRangeChange(e){const{name:t,value:c}=e.target;updateObject({[t]:parseFloat(c).toFixed(0)})}async function setControlValues(){const{material:e}=selectedObject[0],t=await viewerApi.getMaterialProperties(e);document.querySelectorAll("input[type=range]").forEach(e=>{e.value=t[e.name]}),document.querySelectorAll(".checkmark").forEach(e=>{e.classList="checkmark"});let c=document.querySelector(`span[data-label=${selectedObject[0].name}]`);c.classList=`${c.classList} active`}function showControlpanel(){document.querySelector(".control-panel").style.display="block"}function hideControlpanel(){document.querySelector(".control-panel").style.display}function buildObjectList(e){const t=document.querySelector("#object-list");for(let r=0;r<e.length;r++){const s=e[r];var c=document.createElement("li"),a=document.createElement("div");a.classList="control-checklist";var n=document.createElement("label");n.classList="chkwrap";var i=document.createElement("input");i.type="checkbox",i.checked=!0,i.classList="chkVisibility",i.addEventListener("change",e=>togglevisibility(s));let d=formatName(s.name);var o=document.createElement("span");o.classList="checkmark",o.setAttribute("data-label",s.name),n.appendChild(i),n.appendChild(o);var l=document.createElement("a");l.classList="control-object-action cursor-pointer animate__animated animate__bounceIn",l.textContent=d,a.appendChild(n),a.appendChild(l),c.appendChild(a),t.appendChild(c)}}async function togglevisibility(e){e.visible=!e.visible,await viewerApi.setVisibility(e.name,e.visible,!1),console.dir(await viewerApi.getObjectsByName(e.name))}run(),document.body.onload=function(){hideControlpanel(),controlColorPicker.on(["color:init","color:change"],e=>{selectedObject&&updateObject({color:e.hexString})}),document.querySelectorAll("input[type=range]").forEach(e=>{e.addEventListener("change",e=>{handleRangeChange(e)})}),document.querySelectorAll("input[type=checkbox]").forEach(e=>{e.addEventListener("change",e=>{togglevisibility(e)})})};